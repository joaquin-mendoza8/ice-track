{% extends 'base.html' %}
{% import 'components/macros.html' as macros %}

{% block title %}Invoice Details{% endblock %}

{% block content %}
<div class="container-md mb-5">

    {% set return_btn %}
    <div class="btn-group d-print-none">
        <a type="button" href="{{ url_for('invoices.invoices_home') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-90deg-left"></i>&nbsp;&nbsp;Invoices
        </a>
    </div>
    {% endset %}

    {% set current_invoice_popover %}
        {{ macros.info_popover("Current Invoice", "View current invoice information.") }}
    {% endset %}

    {{ macros.section_header("Invoice (#" ~ invoice.id ~ ")", extra_html=return_btn | safe, popover=current_invoice_popover | safe) }}

    <!-- Display basic invoice information -->
    <p><strong>Order ID:</strong> {{ invoice.order.id }}</p>
    <p><strong>Customer Name:</strong> {{ invoice.user.first_name }} {{ invoice.user.last_name }}</p>
    <p><strong>Due Date:</strong> {{ invoice.due_date | date }}</p>

    <!-- Display the list of items in the invoice -->
    {% set print_btn %}
    <button 
        type="button"
        class="btn btn-outline-secondary d-print-none"
        onclick="window.print()">
        <i class="bi bi-printer"></i>&nbsp;&nbsp;Print
    </button>
    {% endset %}

    {% set order_items_popover %}
        {{ macros.info_popover("Order Items", "View all order items associated with the order.") }}
    {% endset %}

    {{ macros.section_header("Order Items", extra_html=print_btn | safe, popover=order_items_popover | safe, size='h3') }}

    <table class="table table-hover table-borderless table-striped">
        <thead>
            <tr>
                <th scope="col">Item Flavor</th>
                <th scope="col">Item Container Size</th>
                <th scope="col">Quantity</th>
                <th scope="col">Line-item Cost</th>
            </tr>
        </thead>
        <tbody>
            {% if invoice.order.order_items %}
                {% for item in invoice.order.order_items %}
                <tr>
                    <td>{{ item.product.flavor | title }}</td>
                    <td>{{ item.product.container_size | title }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.line_item_cost | currency }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td colspan="4">No items found for this invoice.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
    <hr>

    <!-- Display the total amount for the invoice -->
    <div style="max-width: fit-content;">
        <h6>Subtotal: {{ subtotal | currency }}</h6>
        <h6>Shipping Cost: {{ invoice.order.shipping_cost | currency }} ({{ invoice.order.shipping_type | title }})</h6>
        <hr style="border-top: 2px dotted #000;">
    </div>

    <h4>Total Cost: {{ invoice.order.total_cost | currency }}</h4>
</div>
{% endblock %}
